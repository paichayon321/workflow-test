name: Retension_Workflow_run
# troubleshoot query/list workflow action run
# curl -H "Accept: application/vnd.github.v3+json"   https://api.github.com/repos/paichayon321/workflow-test/actions/runs |jq '.workflow_runs[] | .name,.id'

on:
  workflow_dispatch:
    inputs:
      minimumRunsToKeep:
        description: 'Number of workflow runs to keep'
        required: true
        default: "10"
      workflow_name:
        description: 'Workflow_name'
        required: false
        default: ""
      ManualKeep:
        description: 'ManualKeep'
        required: false
        default: "0"

jobs:
  Retension_ManualWorkflow:
    if: ${{ github.event.inputs.workflow_name != '' }}
    runs-on: ubuntu-latest
    steps:
      - name: Delete workflow runs
        uses: mwigginsdev/delete-oldest-workflow-runs@main
        with:
          token: ${{ github.token }}
          repository: ${{ github.repository }}
          keep_minimum_runs: ${{ github.event.inputs.ManualKeep }}
          workflow_name: ${{ github.event.inputs.workflow_name }}
  
#   Retension_ActionFlowList:
#     strategy:
#       matrix:
#         wfname: ['CallCustomActionFlow', 'Retension_Workflow_run']
#     runs-on: ubuntu-latest'
#     steps:
#       - name: Delete workflow runs
#         uses: mwigginsdev/delete-oldest-workflow-runs@main
#         with:
#           token: ${{ github.token }}
#           repository: ${{ github.repository }}
#           keep_minimum_runs: ${{ github.event.inputs.minimumRunsToKeep }}
#           workflow_name: ${{ matrix.wfname }}
          
  Retension_CallCustomActionFlow:
    runs-on: ubuntu-latest
    steps:
      - name: Delete workflow runs
        uses: mwigginsdev/delete-oldest-workflow-runs@main
        with:
          token: ${{ github.token }}
          repository: ${{ github.repository }}
          keep_minimum_runs: ${{ github.event.inputs.minimumRunsToKeep }}
          workflow_name: "CallCustomActionFlow"

  Retension_Retension_Workflow_run:
    runs-on: ubuntu-latest
    steps:
      - name: Delete workflow runs
        uses: mwigginsdev/delete-oldest-workflow-runs@main
        with:
          token: ${{ github.token }}
          repository: ${{ github.repository }}
          keep_minimum_runs: ${{ github.event.inputs.minimumRunsToKeep }}
          workflow_name: "Retension_Workflow_run"
          

          
